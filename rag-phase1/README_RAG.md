# RAG Demo - é˜¶æ®µ 1 å®Œæ•´å®ç°

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ RAG (Retrieval-Augmented Generation) ç³»ç»Ÿæ¼”ç¤ºï¼Œå®ç°äº†æ‰€æœ‰é˜¶æ®µ 1 çš„è¦æ±‚ã€‚

## âœ… å·²å®ç°åŠŸèƒ½

### 1. RAG åŸºæœ¬æ¶æ„
- âœ“ å®Œæ•´çš„æ£€ç´¢å™¨ + ç”Ÿæˆå™¨ååŒæœºåˆ¶
- âœ“ LlamaIndex æ¡†æ¶ + Chroma å‘é‡æ•°æ®åº“
- âœ“ OpenRouter/GPT-4o-mini ä½œä¸ºç”Ÿæˆæ¨¡å‹

### 2. æ–‡æ¡£é¢„å¤„ç†ç­–ç•¥
- âœ“ çµæ´»çš„åˆ‡åˆ†ç²’åº¦ (chunk_size=512, overlap=20)
- âœ“ **å¤šæºæ–‡æ¡£æ‘„å…¥**: æ”¯æŒ Web é¡µé¢ + PDF æ–‡ä»¶
- âœ“ åµŒå…¥æ¨¡å‹é€‰æ‹©: BAAI/bge-small-en-v1.5

### 3. å‘é‡æ•°æ®åº“
- âœ“ Chroma æœ¬åœ°æŒä¹…åŒ–å­˜å‚¨
- âœ“ æ”¯æŒå¢é‡åŠ è½½ï¼ˆé¿å…é‡å¤ç´¢å¼•ï¼‰

### 4. æ£€ç´¢è´¨é‡è¯„ä¼°
- âœ“ æ£€ç´¢ç»“æœè¿‡æ»¤ï¼ˆmetadata filtersï¼‰
- âœ“ ç›¸å…³æ€§è¯„åˆ†æ˜¾ç¤º
- âœ“ å»¶è¿Ÿå’Œå¹»è§‰æ§åˆ¶ï¼ˆé€šè¿‡å¼•ç”¨æ ‡æ³¨ï¼‰

### 5. **æ··åˆæ£€ç´¢ç­–ç•¥** â­ æ–°å¢
- âœ“ å…³é”®è¯æ£€ç´¢ (BM25)
- âœ“ å‘é‡æ£€ç´¢ (Dense Embedding)
- âœ“ é‡æ’åº (BGE-Reranker)
- âœ“ ä¸‰ç§ç­–ç•¥å¯¹æ¯”æ¨¡å¼

### 6. æ ¸å¿ƒå®è·µä»»åŠ¡
- âœ“ æ£€ç´¢ç»“æœè¿‡æ»¤ï¼ˆåŸºäº source_url çš„ç²¾ç¡®åŒ¹é…ï¼‰
- âœ“ ä¸Šä¸‹æ–‡æ‹¼æ¥ä¸å¼•ç”¨æ ‡æ³¨
- âœ“ **å¯¹æ¯”ä¸åŒç­–ç•¥çš„å½±å“**ï¼ˆ--compare æ¨¡å¼ï¼‰

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
pip install -r requirements-rag.txt
```

## ğŸ”‘ é…ç½® API Key

1. å¤åˆ¶é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼š
```bash
cp .env.example .env
```

2. ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„ OpenRouter API Keyï¼š
```
OPENROUTER_API_KEY=your_key_here
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€æ¨¡å¼ï¼ˆä»…å‘é‡æ£€ç´¢ï¼‰
```bash
python rag_demo.py
```

### å¼ºåˆ¶é‡å»ºç´¢å¼•ï¼ˆé¦–æ¬¡è¿è¡Œæˆ–æ·»åŠ æ–°æ–‡æ¡£åï¼‰
```bash
python rag_demo.py --rebuild
```

### ğŸ†• ç­–ç•¥å¯¹æ¯”æ¨¡å¼ï¼ˆæ¨èï¼‰
```bash
python rag_demo.py --compare
```

è¿™å°†ä¾æ¬¡è¿è¡Œä¸‰ç§æ£€ç´¢ç­–ç•¥å¹¶å¯¹æ¯”ç»“æœï¼š
1. **Vector-only**: çº¯å‘é‡æ£€ç´¢ï¼ˆåŸºçº¿ï¼‰
2. **Hybrid**: å‘é‡ + BM25 èåˆæ£€ç´¢
3. **Hybrid + Reranker**: èåˆæ£€ç´¢ + BGE é‡æ’åº

## ğŸ“ æ·»åŠ è‡ªå®šä¹‰ PDF æ–‡æ¡£

1. å°† PDF æ–‡ä»¶æ”¾å…¥ `data/` ç›®å½•ï¼ˆæ”¯æŒå­ç›®å½•ï¼‰
2. è¿è¡Œ `python rag_demo.py --rebuild`
3. ç³»ç»Ÿä¼šè‡ªåŠ¨ç´¢å¼•æ‰€æœ‰ PDF å†…å®¹

ç¤ºä¾‹ï¼š
```
data/
â”œâ”€â”€ technical_docs/
â”‚   â””â”€â”€ your_guide.pdf
â””â”€â”€ research_papers/
    â””â”€â”€ your_paper.pdf
```

## ğŸ¯ ä»£ç ç»“æ„

| æ¨¡å— | åŠŸèƒ½ |
|------|------|
| `configure_settings()` | é…ç½® Embeddingã€LLMã€åˆ†å—ç­–ç•¥ |
| `load_web_documents()` | ä»ç½‘é¡µåŠ è½½å†…å®¹ |
| `load_pdf_documents()` | ä»æœ¬åœ°åŠ è½½ PDF |
| `build_or_load_index()` | æ„å»ºæˆ–åŠ è½½å‘é‡ç´¢å¼• |
| `create_hybrid_retriever()` | åˆ›å»ºæ··åˆæ£€ç´¢å™¨ï¼ˆVector + BM25ï¼‰ |
| `create_reranker()` | åˆ›å»ºé‡æ’åºæ¨¡å‹ |
| `compare_retrieval_strategies()` | å¯¹æ¯”ä¸åŒæ£€ç´¢ç­–ç•¥ |
| `demonstrate_metadata_filter()` | æ¼”ç¤ºå…ƒæ•°æ®è¿‡æ»¤ |

## ğŸ“Š è¯„ä¼°æŒ‡æ ‡

ç³»ç»Ÿè¾“å‡ºåŒ…å«ä»¥ä¸‹è´¨é‡æŒ‡æ ‡ï¼š
- **æ£€ç´¢è¯„åˆ† (score)**: ç›¸ä¼¼åº¦å¾—åˆ†ï¼Œè¶Šé«˜è¶Šç›¸å…³
- **æ¥æºå¼•ç”¨ (source)**: æ¯ä¸ªç­”æ¡ˆéƒ½é™„å¸¦æºæ–‡æ¡£é“¾æ¥
- **æ£€ç´¢æ•°é‡ (top_k)**: é»˜è®¤è¿”å› 4 ä¸ªæœ€ç›¸å…³ç‰‡æ®µ

## ğŸ” é«˜çº§åŠŸèƒ½ç¤ºä¾‹

### å…ƒæ•°æ®è¿‡æ»¤æ£€ç´¢
```python
# ä»£ç ä¸­å·²å®ç°ï¼Œè¿è¡Œæ—¶è‡ªåŠ¨æ¼”ç¤º
# ä»…ä»ç‰¹å®š URL çš„æ–‡æ¡£ä¸­æ£€ç´¢
filters = MetadataFilters(
    filters=[ExactMatchFilter(key="source_url", value=SOURCE_URL)]
)
```

### è‡ªå®šä¹‰é—®é¢˜
ä¿®æ”¹ `rag_demo.py` ä¸­çš„ `QUESTION` å˜é‡ï¼š
```python
QUESTION = "ä½ çš„è‡ªå®šä¹‰é—®é¢˜ï¼Ÿ"
```

## ğŸ“ é˜¶æ®µ 1 è€ƒæ ¸å¯¹ç…§

| è¦æ±‚ | å®ç°çŠ¶æ€ | ä»£ç ä½ç½® |
|------|---------|---------|
| RAG åŸºæœ¬æ¶æ„ | âœ… | æ•´ä½“æ¶æ„ |
| åˆ‡åˆ†ç­–ç•¥ | âœ… | `configure_settings()` |
| å¤šæºæ‘„å…¥ (PDF/Web) | âœ… | `load_web_documents()` + `load_pdf_documents()` |
| å‘é‡æ•°æ®åº“ | âœ… | `init_vector_store()` |
| å…³é”®è¯æ£€ç´¢ | âœ… | `create_hybrid_retriever()` - BM25 |
| é‡æ’åº | âœ… | `create_reranker()` |
| æ£€ç´¢è¿‡æ»¤ | âœ… | `demonstrate_metadata_filter()` |
| å¼•ç”¨æ ‡æ³¨ | âœ… | `append_citations()` |
| ç­–ç•¥å¯¹æ¯” | âœ… | `compare_retrieval_strategies()` |

## ğŸ› å¸¸è§é—®é¢˜

### Q: é¦–æ¬¡è¿è¡Œå¾ˆæ…¢ï¼Ÿ
A: ç¬¬ä¸€æ¬¡è¿è¡Œéœ€è¦ä¸‹è½½ embedding å’Œ reranker æ¨¡å‹ï¼ˆçº¦ 500MBï¼‰ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

### Q: å¦‚ä½•åˆ‡æ¢ä¸åŒçš„ LLMï¼Ÿ
A: ä¿®æ”¹ `configure_settings()` ä¸­çš„ `Settings.llm` é…ç½®ã€‚

### Q: å¦‚ä½•è°ƒæ•´æ£€ç´¢æ•°é‡ï¼Ÿ
A: ä¿®æ”¹ `similarity_top_k` å‚æ•°ï¼ˆé»˜è®¤ 4-5ï¼‰ã€‚

## ğŸ“ ä¸‹ä¸€æ­¥ä¼˜åŒ–æ–¹å‘

- [ ] é›†æˆè‡ªåŠ¨åŒ–è¯„ä¼°æ¡†æ¶ (Ragas/TruLens)
- [ ] æ”¯æŒæ›´å¤šæ–‡æ¡£æ ¼å¼ (DOCX, TXT, CSV)
- [ ] æ·»åŠ æŸ¥è¯¢æ”¹å†™ (Query Rewriting)
- [ ] å®ç°æµå¼è¾“å‡º
- [ ] æ·»åŠ  Web UI ç•Œé¢
